(function(b,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],s):(b=typeof globalThis!="undefined"?globalThis:b||self,s(b["react-polygon-image-cropper"]={},b.React))})(this,function(b,s){"use strict";function M(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var H=M(s);function z(n,t,a){a.beginPath(),a.moveTo(n[t].x,n[t].y),t===n.length-1?a.lineTo(n[0].x,n[0].y):a.lineTo(n[t+1].x,n[t+1].y),a.stroke()}function U(n,t,a){return n.filter(c=>Math.abs(c.x-t.x)<a&&Math.abs(c.y-t.y)<a).length>0}function E(n,t,a){if(t.current&&n.current){const i=n.current.getContext("2d"),c=t.current.getContext("2d");c&&i&&(c.clearRect(0,0,c.canvas.width,c.canvas.height),c.save(),c.beginPath(),a.forEach((y,l)=>{l===a.length-1?c.lineTo(a[0].x,a[0].y):c.lineTo(a[l+1].x,a[l+1].y)}),c.clip(),c.drawImage(i.canvas,0,0,i.canvas.width,i.canvas.height,0,0,c.canvas.width,c.canvas.height),c.restore())}}function W(n,t,a){if(a.current&&t.current){const i=Math.max.apply(null,n.map(g=>g.x)),c=Math.min.apply(null,n.map(g=>g.x)),y=Math.max.apply(null,n.map(g=>g.y)),l=Math.min.apply(null,n.map(g=>g.y)),h=i-c,m=y-l,v=a.current,x=t.current;v.width=h,v.height=m;const C=v.getContext("2d");C==null||C.drawImage(x,c,l,h,m,0,0,h,m),D(t)}}function D(n){if(n.current){const t=n.current.getContext("2d");t==null||t.clearRect(0,0,t.canvas.width,t.canvas.height)}}var $=(()=>`.handle{position:absolute;border-radius:50%;z-index:3}
`)(),j={exports:{}},S={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y=H.default,B=Symbol.for("react.element"),X=Symbol.for("react.fragment"),A=Object.prototype.hasOwnProperty,F=Y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,J={key:!0,ref:!0,__self:!0,__source:!0};function T(n,t,a){var i,c={},y=null,l=null;a!==void 0&&(y=""+a),t.key!==void 0&&(y=""+t.key),t.ref!==void 0&&(l=t.ref);for(i in t)A.call(t,i)&&!J.hasOwnProperty(i)&&(c[i]=t[i]);if(n&&n.defaultProps)for(i in t=n.defaultProps,t)c[i]===void 0&&(c[i]=t[i]);return{$$typeof:B,type:n,key:y,ref:l,props:c,_owner:F.current}}S.Fragment=X,S.jsx=T,S.jsxs=T,j.exports=S;const k=j.exports.jsx,G=j.exports.jsxs,K=({idx:n,updateHandles:t,draggable:a,cropCanvasRef:i,x:c,y,radius:l,color:h})=>{const[m,v]=s.useState({x:c-l/2,y:y-l/2}),x=p=>{var d;const w=(d=i==null?void 0:i.current)==null?void 0:d.getBoundingClientRect();let u=p.clientX,_=p.clientY;w&&(u-=w.left,_-=w.top),t(n,u,_),v({x:u-l/2,y:_-l/2})},C=p=>{p.preventDefault(),x(p)},g=p=>{p.preventDefault(),x(p)};return k("div",{draggable:`${a}`,onDrag:C,onDragStart:p=>!a&&p.preventDefault(),onDragEnd:g,className:"handle",style:{top:m.y,left:m.x,width:l,height:l,backgroundColor:h}})};var tt=(()=>`.react-polygon-bounding-box{position:relative}.react-polygon-image-canvas{position:absolute;top:0;left:0;z-index:1}.react-polygon-crop-canvas{position:absolute;top:0;left:0;z-index:2}.react-polygon-final-canvas{position:absolute;top:0;left:0;z-index:1}
`)();const Q=({width:n,height:t,source:a,radius:i,color:c,draggable:y=!0,proximity:l,cropEvent:h,resetEvent:m,rescaleEvent:v,saveProps:x,styles:C,customCallback:g,updateHandlesCallback:p})=>{const w=s.useRef(null),u=s.useRef(null),_=s.useRef(null),[d,R]=s.useState([]),[L,P]=s.useState(!1),[N,O]=s.useState(!1);s.useEffect(()=>{g&&g(w,u,_)},[]),s.useEffect(()=>{const o=()=>{E(w,u,d),P(!0)},e=h==null?void 0:h.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var r;return(r=e==null?void 0:e.current)==null?void 0:r.removeEventListener("click",o)}},[h,d]),s.useEffect(()=>{const o=()=>{D(u),D(_),R([]),P(!1),O(!1)},e=m==null?void 0:m.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var r;return(r=e==null?void 0:e.current)==null?void 0:r.removeEventListener("click",o)}},[m]),s.useEffect(()=>{const o=()=>{N||(W(d,u,_),R([]),O(!0))},e=v==null?void 0:v.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var r;return(r=e==null?void 0:e.current)==null?void 0:r.removeEventListener("click",o)}},[v,d,N]),s.useEffect(()=>{if(x){const o=x.saveRef,e=()=>{var f;const r=(f=_.current)==null?void 0:f.toDataURL("image/png");r&&x.saveCallback(r)};return o&&o.current&&o.current.addEventListener("click",e),()=>{var r;return(r=o==null?void 0:o.current)==null?void 0:r.removeEventListener("click",e)}}},[x]),s.useEffect(()=>{const o=w.current;if(o){o.width=n*window.devicePixelRatio,o.height=t*window.devicePixelRatio;const r=o.getContext("2d");if(r){const f=new Image;f.onload=function(){r.imageSmoothingEnabled=!1,r.drawImage(f,0,0,f.width*window.devicePixelRatio,f.height*window.devicePixelRatio,0,0,o.width,o.height)},f.src=a}}const e=u.current;e&&(e.width=n,e.height=t)},[a]),s.useEffect(()=>{const o=u.current;if(o){const e=o.getContext("2d");L?E(w,u,d):(e==null||e.clearRect(0,0,o.width,o.height),d.forEach((r,f)=>z(d,f,e)))}},[d,L]);const V=o=>{o.preventDefault();const e=u.current;if(e){const r=e.getBoundingClientRect(),f=o.clientX-r.left,I=o.clientY-r.top;!U(d,{x:f,y:I},l||0)&&!L&&R(q=>[...q,{x:f,y:I,radius:i,color:c}])}},Z=(o,e,r)=>{const f=Array.from(d);f[o]={...f[o],x:e,y:r},R(f),p&&p(f)};return G("div",{className:"react-polygon-bounding-box",style:{height:t,width:n,...C},children:[k("canvas",{style:{height:t,width:n},className:"react-polygon-image-canvas",hidden:L,ref:w}),k("canvas",{style:{height:t,width:n},className:"react-polygon-crop-canvas",ref:u,onClick:V}),k("canvas",{className:"react-polygon-final-canvas",ref:_}),d.map((o,e)=>k(K,{idx:e,...o,updateHandles:Z,draggable:y,cropCanvasRef:u},e))]})};b.Canvas=Q,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=react-polygon-image-cropper.umd.js.map
