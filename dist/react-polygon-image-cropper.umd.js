(function(_,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],s):(_=typeof globalThis!="undefined"?globalThis:_||self,s(_["react-polygon-image-cropper"]={},_.React))})(this,function(_,s){"use strict";function H(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var I=H(s),q=(()=>`.handle{position:absolute;border-radius:50%;z-index:3}
`)(),L={exports:{}},S={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M=I.default,z=Symbol.for("react.element"),U=Symbol.for("react.fragment"),W=Object.prototype.hasOwnProperty,Y=M.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,B={key:!0,ref:!0,__self:!0,__source:!0};function j(n,t,a){var i,c={},y=null,l=null;a!==void 0&&(y=""+a),t.key!==void 0&&(y=""+t.key),t.ref!==void 0&&(l=t.ref);for(i in t)W.call(t,i)&&!B.hasOwnProperty(i)&&(c[i]=t[i]);if(n&&n.defaultProps)for(i in t=n.defaultProps,t)c[i]===void 0&&(c[i]=t[i]);return{$$typeof:z,type:n,key:y,ref:l,props:c,_owner:Y.current}}S.Fragment=U,S.jsx=j,S.jsxs=j,L.exports=S;const k=L.exports.jsx,X=L.exports.jsxs,A=({idx:n,updateHandles:t,draggable:a,cropCanvasRef:i,x:c,y,radius:l,color:h})=>{const[m,v]=s.useState({x:c-l/2,y:y-l/2}),x=u=>{var C;const p=(C=i==null?void 0:i.current)==null?void 0:C.getBoundingClientRect();let w=u.clientX,d=u.clientY;p&&(w-=p.left,d-=p.top),t(n,w,d),v({x:w-l/2,y:d-l/2})},b=u=>{u.preventDefault(),x(u)},g=u=>{u.preventDefault(),x(u)};return k("div",{draggable:`${a}`,onDrag:b,onDragStart:u=>!a&&u.preventDefault(),onDragEnd:g,className:"handle",style:{top:m.y,left:m.x,width:l,height:l,backgroundColor:h}})};var $=(()=>`.react-polygon-bounding-box{position:relative}.react-polygon-image-canvas{position:absolute;top:0;left:0;z-index:1}.react-polygon-crop-canvas{position:absolute;top:0;left:0;z-index:2}.react-polygon-final-canvas{position:absolute;top:0;left:0;z-index:1}
`)();function F(n,t,a){a.beginPath(),a.moveTo(n[t].x,n[t].y),t===n.length-1?a.lineTo(n[0].x,n[0].y):a.lineTo(n[t+1].x,n[t+1].y),a.stroke()}function J(n,t,a){return n.filter(c=>Math.abs(c.x-t.x)<a&&Math.abs(c.y-t.y)<a).length>0}function E(n,t,a){if(t.current&&n.current){const i=n.current.getContext("2d"),c=t.current.getContext("2d");c&&i&&(c.clearRect(0,0,c.canvas.width,c.canvas.height),c.save(),c.beginPath(),a.forEach((y,l)=>{l===a.length-1?c.lineTo(a[0].x,a[0].y):c.lineTo(a[l+1].x,a[l+1].y)}),c.clip(),c.drawImage(i.canvas,0,0,i.canvas.width,i.canvas.height,0,0,c.canvas.width,c.canvas.height),c.restore())}}function G(n,t,a){if(a.current&&t.current){const i=Math.max.apply(null,n.map(g=>g.x)),c=Math.min.apply(null,n.map(g=>g.x)),y=Math.max.apply(null,n.map(g=>g.y)),l=Math.min.apply(null,n.map(g=>g.y)),h=i-c,m=y-l,v=a.current,x=t.current;v.width=h,v.height=m;const b=v.getContext("2d");b==null||b.drawImage(x,c,l,h,m,0,0,h,m),D(t)}}function D(n){if(n.current){const t=n.current.getContext("2d");t==null||t.clearRect(0,0,t.canvas.width,t.canvas.height)}}const K=({width:n,height:t,source:a,radius:i,color:c,draggable:y=!0,proximity:l,cropEvent:h,resetEvent:m,rescaleEvent:v,saveProps:x,styles:b,customCallback:g})=>{const u=s.useRef(null),p=s.useRef(null),w=s.useRef(null),[d,C]=s.useState([]),[R,T]=s.useState(!1),[P,N]=s.useState(!1);s.useEffect(()=>{g&&g(u,p,w)},[]),s.useEffect(()=>{const o=()=>{E(u,p,d),T(!0)},e=h==null?void 0:h.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var r;return(r=e==null?void 0:e.current)==null?void 0:r.removeEventListener("click",o)}},[h,d]),s.useEffect(()=>{const o=()=>{D(p),D(w),C([]),T(!1),N(!1)},e=m==null?void 0:m.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var r;return(r=e==null?void 0:e.current)==null?void 0:r.removeEventListener("click",o)}},[m]),s.useEffect(()=>{const o=()=>{P||(G(d,p,w),C([]),N(!0))},e=v==null?void 0:v.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var r;return(r=e==null?void 0:e.current)==null?void 0:r.removeEventListener("click",o)}},[v,d,P]),s.useEffect(()=>{if(x){const o=x.saveRef,e=()=>{var f;const r=(f=w.current)==null?void 0:f.toDataURL("image/png");r&&x.saveCallback(r)};return o&&o.current&&o.current.addEventListener("click",e),()=>{var r;return(r=o==null?void 0:o.current)==null?void 0:r.removeEventListener("click",e)}}},[x]),s.useEffect(()=>{const o=u.current;if(o){o.width=n*window.devicePixelRatio,o.height=t*window.devicePixelRatio;const r=o.getContext("2d");if(r){const f=new Image;f.onload=function(){r.imageSmoothingEnabled=!1,r.drawImage(f,0,0,f.width*window.devicePixelRatio,f.height*window.devicePixelRatio,0,0,o.width,o.height)},f.src=a}}const e=p.current;e&&(e.width=n,e.height=t)},[a]),s.useEffect(()=>{const o=p.current;if(o){const e=o.getContext("2d");R?E(u,p,d):(e==null||e.clearRect(0,0,o.width,o.height),d.forEach((r,f)=>F(d,f,e)))}},[d,R]);const Q=o=>{o.preventDefault();const e=p.current;if(e){const r=e.getBoundingClientRect(),f=o.clientX-r.left,O=o.clientY-r.top;!J(d,{x:f,y:O},l||0)&&!R&&C(Z=>[...Z,{x:f,y:O,radius:i,color:c}])}},V=(o,e,r)=>{const f=Array.from(d);f[o]={...f[o],x:e,y:r},C(f)};return X("div",{className:"react-polygon-bounding-box",style:{height:t,width:n,...b},children:[k("canvas",{style:{height:t,width:n},className:"react-polygon-image-canvas",hidden:R,ref:u}),k("canvas",{style:{height:t,width:n},className:"react-polygon-crop-canvas",ref:p,onClick:Q}),k("canvas",{className:"react-polygon-final-canvas",ref:w}),d.map((o,e)=>k(A,{idx:e,...o,updateHandles:V,draggable:y,cropCanvasRef:p},e))]})};_.Canvas=K,Object.defineProperties(_,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=react-polygon-image-cropper.umd.js.map
