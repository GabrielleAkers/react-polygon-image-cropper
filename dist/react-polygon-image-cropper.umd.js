(function(_,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],s):(_=typeof globalThis!="undefined"?globalThis:_||self,s(_["react-polygon-image-cropper"]={},_.React))})(this,function(_,s){"use strict";function M(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var H=M(s);function z(n,t,a){a.beginPath(),a.moveTo(n[t].x,n[t].y),t===n.length-1?a.lineTo(n[0].x,n[0].y):a.lineTo(n[t+1].x,n[t+1].y),a.stroke()}function U(n,t,a){return n.filter(c=>Math.abs(c.x-t.x)<a&&Math.abs(c.y-t.y)<a).length>0}function D(n,t,a){if(t.current&&n.current){const r=n.current.getContext("2d"),c=t.current.getContext("2d");c&&r&&(c.clearRect(0,0,c.canvas.width,c.canvas.height),c.save(),c.beginPath(),a.forEach((m,l)=>{l===a.length-1?c.lineTo(a[0].x,a[0].y):c.lineTo(a[l+1].x,a[l+1].y)}),c.clip(),c.drawImage(r.canvas,0,0,r.canvas.width,r.canvas.height,0,0,c.canvas.width,c.canvas.height),c.restore())}}function W(n,t,a){if(a.current&&t.current){const r=Math.max.apply(null,n.map(f=>f.x)),c=Math.min.apply(null,n.map(f=>f.x)),m=Math.max.apply(null,n.map(f=>f.y)),l=Math.min.apply(null,n.map(f=>f.y)),y=r-c,p=m-l,h=a.current,x=t.current;h.width=y,h.height=p;const b=h.getContext("2d");b==null||b.drawImage(x,c,l,y,p,0,0,y,p),j(t)}}function j(n){if(n.current){const t=n.current.getContext("2d");t==null||t.clearRect(0,0,t.canvas.width,t.canvas.height)}}var $=(()=>`.handle{position:absolute;border-radius:50%;z-index:3}
`)(),T={exports:{}},S={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y=H.default,B=Symbol.for("react.element"),X=Symbol.for("react.fragment"),A=Object.prototype.hasOwnProperty,F=Y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,J={key:!0,ref:!0,__self:!0,__source:!0};function P(n,t,a){var r,c={},m=null,l=null;a!==void 0&&(m=""+a),t.key!==void 0&&(m=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)A.call(t,r)&&!J.hasOwnProperty(r)&&(c[r]=t[r]);if(n&&n.defaultProps)for(r in t=n.defaultProps,t)c[r]===void 0&&(c[r]=t[r]);return{$$typeof:B,type:n,key:m,ref:l,props:c,_owner:F.current}}S.Fragment=X,S.jsx=P,S.jsxs=P,T.exports=S;const k=T.exports.jsx,G=T.exports.jsxs,K=({idx:n,updateHandles:t,draggable:a,cropCanvasRef:r,x:c,y:m,radius:l,color:y})=>{const[p,h]=s.useState({x:c-l/2,y:m-l/2}),x=f=>{var w;const C=(w=r==null?void 0:r.current)==null?void 0:w.getBoundingClientRect();let v=f.clientX,d=f.clientY;C&&(v-=C.left,d-=C.top),t(n,v,d),h({x:v-l/2,y:d-l/2})},b=f=>{f.preventDefault(),x(f)};return k("div",{draggable:`${a}`,onDrag:b,onDragStart:f=>!a&&f.preventDefault(),className:"handle",style:{top:p.y,left:p.x,width:l,height:l,backgroundColor:y}})};var tt=(()=>`.react-polygon-bounding-box{position:relative}.react-polygon-image-canvas{position:absolute;top:0;left:0;z-index:1}.react-polygon-crop-canvas{position:absolute;top:0;left:0;z-index:2}.react-polygon-final-canvas{position:absolute;top:0;left:0;z-index:1}
`)();const Q=({width:n,height:t,source:a,radius:r,color:c,draggable:m=!0,proximity:l,cropEvent:y,resetEvent:p,rescaleEvent:h,saveProps:x,styles:b,customCallback:f,updateHandlesCallback:C})=>{const v=s.useRef(null),d=s.useRef(null),w=s.useRef(null),[g,R]=s.useState([]),[L,E]=s.useState(!1),[N,O]=s.useState(!1);s.useEffect(()=>{f&&f(v,d,w)},[]),s.useEffect(()=>{const o=()=>{D(v,d,g),E(!0)},e=y==null?void 0:y.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var i;return(i=e==null?void 0:e.current)==null?void 0:i.removeEventListener("click",o)}},[y,g]),s.useEffect(()=>{const o=()=>{j(d),j(w),R([]),E(!1),O(!1)},e=p==null?void 0:p.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var i;return(i=e==null?void 0:e.current)==null?void 0:i.removeEventListener("click",o)}},[p]),s.useEffect(()=>{const o=()=>{N||(W(g,d,w),R([]),O(!0))},e=h==null?void 0:h.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var i;return(i=e==null?void 0:e.current)==null?void 0:i.removeEventListener("click",o)}},[h,g,N]),s.useEffect(()=>{if(x){const o=x.saveRef,e=()=>{var u;const i=(u=w.current)==null?void 0:u.toDataURL("image/png");i&&x.saveCallback(i)};return o&&o.current&&o.current.addEventListener("click",e),()=>{var i;return(i=o==null?void 0:o.current)==null?void 0:i.removeEventListener("click",e)}}},[x]),s.useEffect(()=>{const o=v.current;if(o){o.width=n*window.devicePixelRatio,o.height=t*window.devicePixelRatio;const i=o.getContext("2d");if(i){const u=new Image;u.onload=function(){i.imageSmoothingEnabled=!1,i.drawImage(u,0,0,u.width*window.devicePixelRatio,u.height*window.devicePixelRatio,0,0,o.width,o.height)},u.src=a}}const e=d.current;e&&(e.width=n,e.height=t)},[a]),s.useEffect(()=>{const o=d.current;if(o){const e=o.getContext("2d");L?D(v,d,g):(e==null||e.clearRect(0,0,o.width,o.height),g.forEach((i,u)=>z(g,u,e)))}},[g,L]);const V=o=>{o.preventDefault();const e=d.current;if(e){const i=e.getBoundingClientRect(),u=o.clientX-i.left,I=o.clientY-i.top;!U(g,{x:u,y:I},l||0)&&!L&&R(q=>[...q,{x:u,y:I,radius:r,color:c}])}},Z=(o,e,i)=>{const u=Array.from(g);u[o]={...u[o],x:e,y:i},R(u),C&&C(u)};return G("div",{className:"react-polygon-bounding-box",style:{height:t,width:n,...b},children:[k("canvas",{style:{height:t,width:n},className:"react-polygon-image-canvas",hidden:L,ref:v}),k("canvas",{style:{height:t,width:n},className:"react-polygon-crop-canvas",ref:d,onClick:V}),k("canvas",{className:"react-polygon-final-canvas",ref:w}),g.map((o,e)=>k(K,{idx:e,...o,updateHandles:Z,draggable:m,cropCanvasRef:d},e))]})};_.Canvas=Q,Object.defineProperties(_,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=react-polygon-image-cropper.umd.js.map
