(function(b,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],s):(b=typeof globalThis!="undefined"?globalThis:b||self,s(b["react-polygon-image-cropper"]={},b.React))})(this,function(b,s){"use strict";function H(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var z=H(s);function U(n,t,a){a.beginPath(),a.moveTo(n[t].x,n[t].y),t===n.length-1?a.lineTo(n[0].x,n[0].y):a.lineTo(n[t+1].x,n[t+1].y),a.stroke()}function W(n,t,a){return n.filter(c=>Math.abs(c.x-t.x)<a&&Math.abs(c.y-t.y)<a).length>0}function D(n,t,a){if(t.current&&n.current){const r=n.current.getContext("2d"),c=t.current.getContext("2d");c&&r&&(c.clearRect(0,0,c.canvas.width,c.canvas.height),c.save(),c.beginPath(),a.forEach((m,l)=>{l===a.length-1?c.lineTo(a[0].x,a[0].y):c.lineTo(a[l+1].x,a[l+1].y)}),c.clip(),c.drawImage(r.canvas,0,0,r.canvas.width,r.canvas.height,0,0,c.canvas.width,c.canvas.height),c.restore())}}function Y(n,t,a){if(a.current&&t.current){const r=Math.max.apply(null,n.map(f=>f.x)),c=Math.min.apply(null,n.map(f=>f.x)),m=Math.max.apply(null,n.map(f=>f.y)),l=Math.min.apply(null,n.map(f=>f.y)),y=r-c,g=m-l,h=a.current,x=t.current;h.width=y,h.height=g;const C=h.getContext("2d");C==null||C.drawImage(x,c,l,y,g,0,0,y,g),j(t)}}function j(n){if(n.current){const t=n.current.getContext("2d");t==null||t.clearRect(0,0,t.canvas.width,t.canvas.height)}}var $=(()=>`.handle{position:absolute;border-radius:50%;z-index:3}
`)(),T={exports:{}},k={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B=z.default,X=Symbol.for("react.element"),A=Symbol.for("react.fragment"),F=Object.prototype.hasOwnProperty,J=B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,G={key:!0,ref:!0,__self:!0,__source:!0};function P(n,t,a){var r,c={},m=null,l=null;a!==void 0&&(m=""+a),t.key!==void 0&&(m=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)F.call(t,r)&&!G.hasOwnProperty(r)&&(c[r]=t[r]);if(n&&n.defaultProps)for(r in t=n.defaultProps,t)c[r]===void 0&&(c[r]=t[r]);return{$$typeof:X,type:n,key:m,ref:l,props:c,_owner:J.current}}k.Fragment=A,k.jsx=P,k.jsxs=P,T.exports=k;const S=T.exports.jsx,K=T.exports.jsxs,Q=({idx:n,updateHandles:t,draggable:a,cropCanvasRef:r,x:c,y:m,radius:l,color:y})=>{const[g,h]=s.useState({x:c-l/2,y:m-l/2}),x=f=>{var _;const w=(_=r==null?void 0:r.current)==null?void 0:_.getBoundingClientRect();let v=f.clientX,d=f.clientY;w&&(v-=w.left,d-=w.top),t(n,v,d),h({x:v-l/2,y:d-l/2})},C=f=>{f.preventDefault(),x(f)};return S("div",{draggable:`${a}`,onDrag:C,onDragStart:f=>!a&&f.preventDefault(),className:"handle",style:{top:g.y,left:g.x,width:l,height:l,backgroundColor:y}})};var tt=(()=>`.react-polygon-bounding-box{position:relative}.react-polygon-image-canvas{position:absolute;top:0;left:0;z-index:1}.react-polygon-crop-canvas{position:absolute;top:0;left:0;z-index:2}.react-polygon-final-canvas{position:absolute;top:0;left:0;z-index:1}
`)();const V=({width:n,height:t,source:a,radius:r,color:c,draggable:m=!0,proximity:l,cropEvent:y,resetEvent:g,rescaleEvent:h,saveProps:x,styles:C,customCallback:f,updateHandlesCallback:w})=>{const v=s.useRef(null),d=s.useRef(null),_=s.useRef(null),[p,R]=s.useState([]),[L,E]=s.useState(!1),[N,O]=s.useState(!1);s.useEffect(()=>{f&&f(v,d,_)},[]),s.useEffect(()=>{const o=()=>{D(v,d,p),E(!0)},e=y==null?void 0:y.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var i;return(i=e==null?void 0:e.current)==null?void 0:i.removeEventListener("click",o)}},[y,p]),s.useEffect(()=>{const o=()=>{j(d),j(_),R([]),E(!1),O(!1)},e=g==null?void 0:g.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var i;return(i=e==null?void 0:e.current)==null?void 0:i.removeEventListener("click",o)}},[g]),s.useEffect(()=>{const o=()=>{N||(Y(p,d,_),R([]),O(!0))},e=h==null?void 0:h.elementRef;return e&&e.current&&e.current.addEventListener("click",o),()=>{var i;return(i=e==null?void 0:e.current)==null?void 0:i.removeEventListener("click",o)}},[h,p,N]),s.useEffect(()=>{if(x){const o=x.saveRef,e=()=>{var u;const i=(u=_.current)==null?void 0:u.toDataURL("image/png");i&&x.saveCallback(i)};return o&&o.current&&o.current.addEventListener("click",e),()=>{var i;return(i=o==null?void 0:o.current)==null?void 0:i.removeEventListener("click",e)}}},[x]),s.useEffect(()=>{const o=v.current;if(o){o.width=n*window.devicePixelRatio,o.height=t*window.devicePixelRatio;const i=o.getContext("2d");if(i){const u=new Image;u.onload=function(){i.imageSmoothingEnabled=!1,i.drawImage(u,0,0,u.width*window.devicePixelRatio,u.height*window.devicePixelRatio,0,0,o.width,o.height)},u.src=a}}const e=d.current;e&&(e.width=n,e.height=t)},[a]),s.useEffect(()=>{const o=d.current;if(o){const e=o.getContext("2d");L?D(v,d,p):(e==null||e.clearRect(0,0,o.width,o.height),p.forEach((i,u)=>U(p,u,e)))}},[p,L]);const Z=o=>{o.preventDefault();const e=d.current;if(e){const i=e.getBoundingClientRect(),u=o.clientX-i.left,I=o.clientY-i.top;if(!W(p,{x:u,y:I},l||0)&&!L){const M=[...p,{x:u,y:I,radius:r,color:c}];w&&w(M),R(M)}}},q=(o,e,i)=>{const u=Array.from(p);u[o]={...u[o],x:e,y:i},w&&w(u),R(u)};return K("div",{className:"react-polygon-bounding-box",style:{height:t,width:n,...C},children:[S("canvas",{style:{height:t,width:n},className:"react-polygon-image-canvas",hidden:L,ref:v}),S("canvas",{style:{height:t,width:n},className:"react-polygon-crop-canvas",ref:d,onClick:Z}),S("canvas",{className:"react-polygon-final-canvas",ref:_}),p.map((o,e)=>S(Q,{idx:e,...o,updateHandles:q,draggable:m,cropCanvasRef:d},e))]})};b.Canvas=V,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=react-polygon-image-cropper.umd.js.map
